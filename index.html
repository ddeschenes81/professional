<!DOCTYPE html>

<head>
     
     <!-- JAVASCRIPT-->
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><!-- jQuery CDN-->
     <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script><!-- VUE JS CDN-->
     <script src="public/js/parallax.js"></script><!-- Parallax -->
     <script src="public/js/main.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/trianglify/1.1.0/trianglify.min.js"></script>
     
     <!--FONTS -->
     
     <link href="https://fonts.googleapis.com/css?family=Dosis:300,400,500,600,700" rel="stylesheet">
     <link href="https://fonts.googleapis.com/css?family=Lato:400,800|Raleway:400,900" rel="stylesheet">
     
     <!-- CSS -->
     <link href='public/css/master.css' rel='stylesheet' type='text/css'><!-- Remove all default styling -->
     <link href='public/css/main_two.css' rel='stylesheet' type='text/css'>
     <link href='public/css/rotation.css' rel='stylesheet' type='text/css'>
     <link href='public/css/timeline.css' rel='stylesheet' type='text/css'>


     
     <script>
          /**
           *
           *   VARIABLES
           *
           */
          var data = [{}]; // Hold JSON objects from AJAX calls
          
          var cdc = 1; // Current Div Class - this is the current article
          var ndh; // Next Div Height - height of the next article
          var pdh; //  Previous Div Height - height of the div before Current
          var hh; // This is the height of the header element (not to be confused with <header>)
          
          var st; // The current position of the scroll on the page
          var lst = 0; // As above, but saved between each firing of the event so that we can determine if scroll is going up or down
          var stStart;  // This is the beginning range (in pixels) for where we will detect a new article
          var stStop; // And this is the end of that range
          
          
          $(document).ready(function(){
               
               $.getJSON("src/database.class.php", {

               }).done(function(data) {   
               
                    i = 0;

                    $.each( data, function( index, value ) {
                         
                         if (i === 0) {shadow = ' shadow'; active = ' active';} else {shadow = ''; active = '';}
                         if (value.type === 'sub') {indent = ' indent'; small = ' small';} else {indent = ''; small = '';}
                         
                         articleDiv = '<div class="section ' + value.id + shadow + indent +'">' + value.content + '</div>';
                         timelineDiv = '<div class="timeline-item ' + value.id + small + active + '">' + value.title + '</div>';
                         
                         i++;
                              
                         $('.content').append(articleDiv);
                         $('.timeline').append(timelineDiv);
                         
                    });

                    //   Initialize the variables for timeline highlighting
                    hh = $('header').height();
                    cdh = $("." + cdc).height(); 
                    ndh = $("." + cdc).next().height(); 
                    pdh = 0;                         

                    stStart = 0;
                    stStop = stStart + $("." + cdc).height();
                    
               });
               

               

      
               window.addEventListener('scroll', function(){
                    
                    st = $(this).scrollTop() + 20;
                    
                    if (st > lst) {

                         /**
                          *
                          *   We are scrolling DOWN the page
                          *   
                          *
                          */
                         
                         $('header').addClass('animate');

                         if (st > stStop) {
                              
                              console.log('passed a div');
                              
                              checkDiv = cdc + 1;
                              if($(".section." + checkDiv).length == 0) {
                                   return false;
                              }
                              
                              $('.timeline-item.' + cdc).removeClass('active').addClass('inactive');
                              $('.' + cdc).removeClass('shadow');
                              
                              cdc++;
                              
                              $('.timeline-item.' + cdc).removeClass('inactive').addClass('active');
                              $('.' + cdc).addClass('shadow');
                              
                              cdh = $('.' + cdc).height();
    
                              stStart = stStart + cdh;
                              stStop = stStop + cdh;

                         
                         }                          
                         
                    } else if (st <= 20) {
                         // Scroll reached the TOP of the page
                         $('header').removeClass('animate');
                         
                    } else {
                         // We are scrolling UP the page
                         if (st < stStart) {
                              
                              cdh = $('.' + cdc).height();
    
                              stStart = stStart - cdh;
                              stStop = stStop - cdh;
                              
                              $('.timeline-item.' + cdc).removeClass('active').addClass('inactive');
                              $('.' + cdc).removeClass('shadow');
                              
                              cdc--;
                              
                              $('.timeline-item.' + cdc).removeClass('inactive').addClass('active');
                              $('.' + cdc).addClass('shadow');
                              
                         }
                         
                    }
                    
                    lst = st;                    

               });
   
               $('body').on('click','.timeline-item',function() {
                    
                    /**
                     *
                     *        Iterate through classes of the clicked element to find the numerical class to reference the proper article.
                     *        Then we cause the page to scroll to said article.
                     *        
                     */
                    classToScroll = 0;
                    classes = $(this).attr('class').split(/\s+/);

                    $.each(classes, function(index, value) {
                         if (value != 'small' && value != 'timeline-item' && value != 'active' && value != 'inactive' && value != 'shadow') {
                              classToScroll = value;
                         }
                    });
                    
                    divHeight = $('.' + classToScroll).height;
                    console.log('offset' + parseInt($('.' + classToScroll).offset().top - hh - divHeight));
                    $('html,body').animate({
                         scrollTop: $('.' + classToScroll).offset().top
                    });
                              
               });
               
               var pattern = Trianglify({
                    cell_size: 150,
                    variance: 0.9,
                    x_colors: ['#fdea92','#fbcb63','#85dac4','#1f8a8c','#c3b8b4'],
                    y_colors: 'match_x',
                    color_space: 'lab',
                    color_function: false,
                    stroke_width: 1.51,
                    seed: null,                    
                    height: window.innerWidth,
                    width: window.innerHeight
               });
               
               document.body.appendChild(pattern.canvas());
               
          });
          
     </script>
     
    
     
</head>

<body>
     
     
     
     <div class="wrapper">

          <header>
               
               <h1>Darren Deschenes</h1>
               <p class="details">Contact Me:<a href="mailto:daedalus81@gmail.com">daedalus81@gmail.com</a></p>
               
          </header>          
          
          <div class="content">          
     
          </div>
          
          <!--
          <div class="footer">

          </div>
          -->
       
     </div>

     <div class="timeline">
                         
     </div>        

     <canvas></canvas>
     
</body>